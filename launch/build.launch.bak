<launch>
    <!-- load params -->
    <rosparam file="$(find dataset_builder)/params/dicts.yaml" command="load"/>

    <!-- get input args -->
    <arg name="rf_client" default='false'/>
    <arg name="rf_cfg" default="$(env HRI_CACTI_XR_PATH)/robofleet/hl-ss-config.yaml"/>
    <arg name="outdir" default="$(find dataset_builder)/dataset"/>
    <arg name="class" default="Advance"/>
    <arg name="bag" default='true'/>

    <!-- set params -->
    <param name="class_name" value="$(arg class)"/>
    <param name="base_outdir" value="$(arg outdir)"/>
    <param name="timestamp" value="0"/>
    <param name="image_fps" value="10"/>

    <!-- configure topics -->
    <param name="start_topic_name"  value="/hololens/natural_input_capture/start"   />
    <param name="stop_topic_name"   value="/hololens/natural_input_capture/end"     />
    <param name="mono_ll_topic"     value="/hololens/LEFT_LEFT/image_raw"           />
    <param name="mono_lf_topic"     value="/hololens/LEFT_FRONT/image_raw"          />
    <param name="mono_rf_topic"     value="/hololens/RIGHT_FRONT/image_raw"         />
    <param name="mono_rr_topic"     value="/hololens/RIGHT_RIGHT/image_raw"         />
    <param name="mic_topic"         value="/hololens/microphone/data"               />

    <!-- robofleet client -->
    <group if="$(arg rf_client)" ns="robofleet_client"> 
	    <node
	    	name    = "robofleet_client"
	    	pkg     = "robofleet_client"
	    	type    = "client"
	    	output  = "screen"
	    	args	= "$(arg rf_cfg)"
	    />
    </group>

    <!-- config params -->
    <group ns="config_params_node">
        <node 
            name    = "config_params" 
            pkg     = "dataset_builder" 
            type    = "config_params.py" 
            output  = "screen"
        />
    </group>

    <!-- mono left left camera stream -->
    <group ns="mono_ll">
        <param name ="filepath" value="$(arg outdir)/devices/mono_ll/raw/$(arg class)/"/>
        <param name ="filename" value="set_dynamically"/>
        <param name ="save_multi_stream_in_sequence" value='true'/>
        <param name ="topicname_image" value="$(arg mono_ll_topic)"/>
        <param name ="fps" value="$(arg image_fps)"/>
        <param name ="topicname_empty" value="/hololens/LEFT_LEFT/stop"/>
        <node 
            name    ="save_raw_image_stream" 
            pkg     ="image_writer" 
            type    ="save_raw_image_stream" 
            output  ="screen"
        />
    </group>

    <!-- mono left front camera stream -->
    <group ns="mono_lf">
        <param name ="filepath" value="$(arg outdir)/devices/mono_lf/raw/$(arg class)/"/>
        <param name ="filename" value="set_dynamically"/>
        <param name ="save_multi_stream_in_sequence" value='true'/>
        <param name ="topicname_image" value="$(arg mono_lf_topic)"/>
        <param name ="fps" value="$(arg image_fps)"/>
        <param name ="topicname_empty" value="/hololens/LEFT_FRONT/stop"/>
        <node 
            name    ="save_raw_image_stream" 
            pkg     ="image_writer" 
            type    ="save_raw_image_stream" 
            output  ="screen"
        />
    </group>

    <!-- mono right front camera stream -->
    <group ns="mono_rf">
        <param name ="filepath" value="$(arg outdir)/devices/mono_rf/raw/$(arg class)/"/>
        <param name ="filename" value="set_dynamically"/>
        <param name ="save_multi_stream_in_sequence" value='true'/>
        <param name ="topicname_image" value="$(arg mono_rf_topic)"/>
        <param name ="fps" value="$(arg image_fps)"/>
        <param name ="topicname_empty" value="/hololens/RIGHT_FRONT/stop"/>
        <node 
            name    ="save_raw_image_stream" 
            pkg     ="image_writer" 
            type    ="save_raw_image_stream" 
            output  ="screen"
        />
    </group>

    <!-- mono right right camera stream -->
    <group ns="mono_rr">
        <param name ="filepath" value="$(arg outdir)/devices/mono_rr/raw/$(arg class)/"/>
        <param name ="filename" value="set_dynamically"/>
        <param name ="save_multi_stream_in_sequence" value='true'/>
        <param name ="topicname_image" value="$(arg mono_rr_topic)"/>
        <param name ="fps" value="$(arg image_fps)"/>
        <param name ="topicname_empty" value="/hololens/RIGHT_RIGHT/stop"/>
        <node 
            name    ="save_raw_image_stream" 
            pkg     ="image_writer" 
            type    ="save_raw_image_stream" 
            output  ="screen"
        />
    </group>
    
    <!-- microphone audio stream -->
    <group ns="mic">
        <include file="$(find image_writer)/launch/write_audio.launch"/>
            <arg name="path" default="$(arg outdir)/devices/mic/raw/$(arg class)/"/>
            <arg name="name" default="output"/>
            <arg name="topic" default="$(arg mic_topic)"/>
            <arg name="downsample" default="false"/>
    </group> 

</launch>